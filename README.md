![Essem Logo](/console/htdocs/img/essemlogo0.png)

Essem is a server that accepts, stores, indexes, and graphs metrics as supplied
by [Dropwizard Metrics](https://dropwizard.github.io/metrics/3.1.0/). It
uses an [Elasticsearch](http://www.elasticsearch.org/) [&reg;](http://www.elasticsearch.org/trademarks/) instance for storing and selecting data for graphs.
A Metrics [`ScheduledReporter`](https://github.com/dropwizard/metrics/blob/master/metrics-core/src/main/java/com/codahale/metrics/ScheduledReporter.java) is provided
to allow applications to periodically push metrics to Essem.
Essem can also be configured to poll endpoints that expose metrics in the JSON format defined by
the Dropwizard [`MetricsModule`](https://github.com/dropwizard/metrics/blob/master/metrics-json/src/main/java/com/codahale/metrics/json/MetricsModule.java).
JSON documents in this same format may also be `PUT` to the server.

Graphs of reported metrics can be queried using a JSON API. Essem also provides a querying and graphing console
that makes it fast and easy to find and examine any metric field at various resolutions. 
Charts are generated by [*MetricsGraphics.js*](http://metricsgraphicsjs.org/),
based on [D3](http://d3js.org/).

![Essem Logo](/console/htdocs/img/screenshot01.png)

Key Features
------------

* Authenticated HTTP(s) Reporting API
* Authenticated HTTP(s) Graph API
* Supports counters, gauges, histograms, meters, and timers.
* Metrics organized by application, host and type.
* Graph console provides search and filters to quickly find and graph metrics at various resolutions.
* On-the-fly, server-side downsampling with selectable windows and functions.
* Reporters may supply timestamps to allow historical data to be indexed.
* Application-specific data retention policy.
* Storage/capacity limited only by the capacity of the connected Elasticsearch instance/cluster.

Requirements
------------

* [JRE/JDK 7+](http://www.oracle.com/technetwork/java/javase/downloads/index.html)
* An [Elasticsearch](http://www.elasticsearch.org/) installation.

Elasticsearch Considerations
----------------------------

* Be aware that Elasticsearch (ES) has no built-in security. Unless you want your install open to the world, check the configuration
to make sure the server does not bind to a public address. It may be a good idea to change the configuration to
bind only to localhost and use a proxy such as [nginx](http://nginx.org/) to allow authenticated access.

* By default, ES is configured to automatically generate a schema for any JSON document. This is supposed to be
a feature, but it can be a big headache if you need to change the mapping for a field later. You may want to set
this configuration: [`index.mapper.dynamic: false`](http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/mapping-dynamic-mapping.html).

* ES makes it easy to accidentally delete all your indexes. You should change this configuration immediately
after install: [`action.destructive_requires_name: true`](http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/indices-delete-index.html)
or `action.disable_delete_all_indices: true`.

* Sorting and aggregation (heavily used by Essem) use the Lucene field cache by default. This can consume _a lot_ of memory.
The latest versions of Lucene (and ES) have added an option to use "doc values". This allows values to be stored on-disk
in ["column-stride" format](http://www.elasticsearch.org/blog/disk-based-field-data-a-k-a-doc-values/), significantly reducing 
the memory requirements. Essem is distributed with a schema that uses "doc values" and it is the default choice. 

Build
-----

Essem may be built from source using [Ant](http://ant.apache.org/) with [Ivy](http://ant.apache.org/ivy/) supplying
dependency resolution.

Quick Start
-----------

* `git clone git@github.com:attribyte/essem.git`
* If ivy is not installed with your ant distribution: `ant init-ivy`
* `ant full-dist`
* `ant dist-test`
* Copy `config/example.properties` to `config/config.properties`
* Edit `config.properties`. Change `esEndpoint` to point to your ES server.
* Copy `config/example.log.properties` to `config/log.properties`
* Start: `bin/start`
* Add some test data: `bin/simulate` One minute of historical data is added per second.
* Open `http://localhost:8086/console/test` in a browser to view the console for the essem server metrics.
  At the prompt: username: `test` password: `secret`
* Stop adding simulated data: `bin/stop-simulator`
* Stop: `bin/stop`

Bugs
----

* Example configuration files must be documented.
* JSON response formats and available API query parameters must be documented.

TODO
----

* Create "shaded" build for standard reporter to avoid potential client protocol buffer incompatibility.
* Create JSON-based `ScheduledReporter`.
* Allow CORS headers to be configured for API access.
* Auto-refresh

Possible Enhancements
----------------------

* Graphite sampler/back-end
* Emit Graphite JSON format
